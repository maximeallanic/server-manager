/*
 * Copyright 2018 Your Company ISC License License
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 * Created by mallanic <maxime@allanic.me> at 05/06/2018
 */

angular.module('router')
    .config(function ($stateProvider) {
        <% _.forEach(controllers, function (controller) { %>
        $stateProvider.state('router.<%= controller.path %>', {
            url: '/<%= controller.path %>',
            templateUrl: '/<%= controller.path %>/<%= controller.view %>',
            resolve: {
                '<%= _.camelCase(controller.path) %>': function ($api) {
                    return $api[ '<%= _.camelCase(controller.path) %>' ].getList();
                }
            },
            controllerAs: '<%= _.camelCase(controller.path) %>Ctrl',
                controller: function (<%= _.camelCase(controller.path) %>) {
                console.log(<%= _.camelCase(controller.path) %>)
                this[ '<%= _.camelCase(controller.path) %>' ] = <%= _.camelCase(controller.path) %>;
            }
        });
        <% }) %>
    })
    .service('$api', function ($http) {
        function request(path, method, data) {
            return $http({
                method: 'GET',
                url: path
            }).then(function (result) {
                return result.data;
            });
        }

        var $api = {
            <% _.forEach(controllers, function (controller) { %>
            '<%= _.camelCase(controller.path) %>': {
                getList: function () {
                    return request('/api/<%= controller.path %>', 'GET');
                }
            },
            <% }) %>
        };

        return $api;
    });

